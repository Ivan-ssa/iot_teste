<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leitor de Tags RFID</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    /* Define a fonte Inter para todo o corpo da página */
    body {
      font-family: "Inter", sans-serif;
    }
    /* Estilo para a barra de rolagem personalizada (se houver conteúdo rolável) */
    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05); /* Fundo sutil para a trilha da barra de rolagem */
      border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2); /* Cor da "alça" da barra de rolagem */
      border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3); /* Cor da "alça" da barra de rolagem ao passar o mouse */
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6">
  <div class="bg-white rounded-2xl shadow-lg p-10 md:p-14 max-w-lg w-full text-center">
    <h1 class="text-4xl md:text-5xl font-extrabold mb-6 text-indigo-800 drop-shadow-md">
      Leitor de Tags RFID
    </h1>
    <p class="text-2xl md:text-3xl text-gray-700 mb-8">
      Última Tag Lida:
      <span id="tagAtual" class="font-bold text-green-600 text-5xl md:text-6xl block mt-2">
        Aguardando Tag...
      </span>
    </p>
    <div id="statusMessage" class="mt-4 text-lg font-medium text-gray-500"></div>
  </div>

  <script>
    const tagElement = document.getElementById('tagAtual');
    const statusMessageElement = document.getElementById('statusMessage');
    // CERTIFIQUE-SE DE QUE ESTA URL É A CORRETA DA SUA API NO RENDER.COM
    const API_URL = 'https://iot-teste.onrender.com/latest-tag';
    const FETCH_INTERVAL_MS = 1000; // Atualiza a cada 1 segundo

    /**
     * Atualiza o texto da tag e a mensagem de status na interface.
     * @param {string} text - O texto principal a ser exibido (UID da tag ou mensagem de estado).
     * @param {string} colorClass - Classe Tailwind CSS para a cor do texto da tag (ex: 'text-green-600').
     * @param {string} statusText - Mensagem de status adicional (ex: 'Conectado à API').
     * @param {string} statusColorClass - Classe Tailwind CSS para a cor da mensagem de status.
     */
    function updateUI(text, colorClass, statusText, statusColorClass) {
      tagElement.textContent = text;
      // Remove todas as classes de cor anteriores e adiciona a nova
      tagElement.classList.remove('text-green-600', 'text-red-600', 'text-orange-600');
      tagElement.classList.add(colorClass);

      statusMessageElement.textContent = statusText;
      statusMessageElement.classList.remove('text-gray-500', 'text-red-500', 'text-green-500');
      statusMessageElement.classList.add(statusColorClass);
    }

    /**
     * Função assíncrona para buscar e atualizar o número da tag.
     */
    async function fetchTag() {
      try {
        updateUI('Buscando...', 'text-orange-600', 'Conectando à API...', 'text-gray-500');

        const res = await fetch(API_URL);

        if (!res.ok) {
          // Lança um erro com mais detalhes para ser capturado no catch
          const errorBody = await res.text(); // Tenta ler o corpo da resposta para mais detalhes
          throw new Error(`Erro HTTP ${res.status}: ${res.statusText}. Detalhes: ${errorBody.substring(0, 100)}...`);
        }

        const contentType = res.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          const textResponse = await res.text();
          throw new Error(`Resposta inesperada. Esperado JSON, mas recebeu "${contentType || 'Nenhum'}". Conteúdo: ${textResponse.substring(0, 100)}...`);
        }

        const data = await res.json();

        if (data.tagId) {
          updateUI(data.tagId, 'text-green-600', 'Tag atualizada com sucesso!', 'text-green-500');
        } else {
          updateUI('Nenhuma tag lida ainda.', 'text-orange-600', 'API conectada, aguardando tags...', 'text-gray-500');
        }
      } catch (err) {
        // Em caso de erro na conexão com a API ou no processamento da resposta
        updateUI('Erro de Conexão!', 'text-red-600', `Não foi possível conectar à API: ${err.message}`, 'text-red-500');
        console.error("Erro ao buscar tag:", err);
      }
    }

    // Define um intervalo para atualizar a tag
    setInterval(fetchTag, FETCH_INTERVAL_MS);
    // Chama a função uma vez imediatamente ao carregar a página
    fetchTag();
  </script>
</body>
</html>
